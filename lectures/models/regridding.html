
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta property="og:title" content="Model validation: Comparing a state estimate to observations" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://earth-env-data-science.github.io/lectures/models/regridding.html" />
<meta property="og:site_name" content="Python" />
<meta property="og:description" content="We start by importing xarray, numpy and matplotlib as usual The model we will be using in this lecture is the Southen Ocean State Estimate (SOSE), which is available in the pangeo cloud as an intak..." />
<meta property="og:image" content="https://earth-env-data-science.github.io/_images/regridding_5_1.png" />
<meta property="og:image:alt" content="Python" />
<meta name="description" content="We start by importing xarray, numpy and matplotlib as usual The model we will be using in this lecture is the Southen Ocean State Estimate (SOSE), which is available in the pangeo cloud as an intak..." />

    <title>Model validation: Comparing a state estimate to observations &#8212; Earth and Environmental Data Science</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://earth-env-data-science.github.io/lectures/models/regridding.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Calculating properties in the native model grid using xgcm" href="xgcm.html" />
    <link rel="prev" title="Assignment: Calculate wet bulb temperature for CMIP6 models" href="../../assignments/cmip.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/eeds-logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Earth and Environmental Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    An Introduction to Earth and Environmental Data Science
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About this Book
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../LICENSE.html">
   License for this book
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../projects.html">
   Final Projects
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The Interactive Computing Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../environment/intro_to_jupyterlab.html">
   Intro to JupyterLab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../environment/intro_to_unix.html">
   Intro to Unix
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../environment/intro_to_git.html">
   Intro to Git for Version Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/files_markdown_git.html">
   Assignment: Files, Git, and Github
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../environment/python_environments.html">
   Managing Python Environments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../environment/binder.html">
   Binder for Reproducible Research
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data.html">
   All About Data
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  The Core Python Language
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../core_python/python_fundamentals.html">
   Python Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../core_python/functions_classes.html">
   Python Functions and Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../core_python/organization_and_packaging.html">
   Organization and Packaging of Python Projects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/python_basics_and_functions.html">
   Assignment: Basic Python
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Scientific Python Fundamentals
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../basic_scipy/numpy_and_matplotlib.html">
   Numpy and Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/numpy_matplotlib.html">
   Assignment: Numpy and Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../basic_scipy/more_matplotlib.html">
   More Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/more_matplotlib.html">
   Assignment: More Matplotlib
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  High Level Data Analysis Frameworks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../pandas/pandas_intro.html">
   Pandas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/basic_pandas.html">
     Pandas Fundamentals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../assignments/basic_pandas.html">
     Assignment: Pandas Fundamentals with Earthquake Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../pandas/pandas_groupby.html">
     Pandas: Groupby
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../assignments/pandas_groupby.html">
     Assignment: Pandas Groupby with Hurricane Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../xarray/xarray_intro.html">
   Xarray for multidimensional gridded data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../xarray/xarray.html">
     Xarray Fundamentals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../assignments/basic_xarray.html">
     Assignment: Xarray Fundamentals with Atmospheric Radiation Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../xarray/xarray-part2.html">
     Xarray Interpolation, Groupby, Resample, Rolling, and Coarsen
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../assignments/more_xarray.html">
     Assignment: More Xarray with El Ni√±o-Southern Oscillation (ENSO) Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../xarray/xarray_tips_and_tricks.html">
     Xarray Tips and Tricks
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Geoscience Package
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../mapping_cartopy.html">
   Maps in Scientific Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/cartopy.html">
   Assignment: Making Maps with Cartopy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Climate Model Data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro_models.html">
   Working With Earth Science Model Output
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cmip.html">
   Working with output from many different CMIP6 climate models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assignments/cmip.html">
   Assignment: Calculate wet bulb temperature for CMIP6 models
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Model validation: Comparing a state estimate to observations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="xgcm.html">
   Calculating properties in the native model grid using xgcm
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Big Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../dask/intro.html">
   Dask for Parallel Computing in Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dask/dask_arrays.html">
   Computing with Dask
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://https://us-central1-b.gcp.pangeo.io/hub/user-redirect/git-pull?repo=https%3A//github.com/earth-env-data-science/earth-env-data-science-book&urlpath=lab/tree/earth-env-data-science-book/src/lectures/models/regridding.ipynb&branch=master"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/earth-env-data-science/earth-env-data-science-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/earth-env-data-science/earth-env-data-science-book/issues/new?title=Issue%20on%20page%20%2Flectures/models/regridding.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/earth-env-data-science/earth-env-data-science-book/edit/master/src/lectures/models/regridding.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/lectures/models/regridding.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#considerations-for-model-validation">
   Considerations for model validation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regridding-via-interpolation">
   Regridding via interpolation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regridding-using-conservative-interpolation">
   Regridding using conservative interpolation
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Model validation: Comparing a state estimate to observations</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#considerations-for-model-validation">
   Considerations for model validation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regridding-via-interpolation">
   Regridding via interpolation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regridding-using-conservative-interpolation">
   Regridding using conservative interpolation
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="model-validation-comparing-a-state-estimate-to-observations">
<h1>Model validation: Comparing a state estimate to observations<a class="headerlink" href="#model-validation-comparing-a-state-estimate-to-observations" title="Permalink to this headline">#</a></h1>
<p>We start by importing xarray, numpy and matplotlib as usual</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<p>The model we will be using in this lecture is the <a class="reference external" href="http://sose.ucsd.edu">Southen Ocean State Estimate (SOSE)</a>, which is available in the pangeo cloud as an <a class="reference external" href="https://pangeo-data.github.io/pangeo-datastore/master/ocean.html">intake catalogue</a>. We will just follow the <a class="reference external" href="https://pangeo-data.github.io/pangeo-datastore/master/ocean.html#collapse1-sose">instructions</a> how to load the data into our notebook and inspect the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">intake</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">Catalog</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/pangeo-data/pangeo-datastore/master/intake-catalogs/ocean.yaml&quot;</span><span class="p">)</span>
<span class="n">ds_model</span> <span class="o">=</span> <span class="n">cat</span><span class="p">[</span><span class="s2">&quot;SOSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dask</span><span class="p">()</span>
<span class="n">ds_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:   (XC: 2160, XG: 2160, YC: 320, YG: 320, Z: 42, Zl: 42, Zp1: 43, Zu: 42, time: 438)
Coordinates:
    Depth     (YC, XC) float32 dask.array&lt;shape=(320, 2160), chunksize=(320, 2160)&gt;
    PHrefC    (Z) float32 dask.array&lt;shape=(42,), chunksize=(42,)&gt;
    PHrefF    (Zp1) float32 dask.array&lt;shape=(43,), chunksize=(43,)&gt;
  * XC        (XC) float32 0.083333336 0.25 0.4166667 ... 359.75 359.9167
  * XG        (XG) float32 5.551115e-17 0.16666667 ... 359.6667 359.83334
  * YC        (YC) float32 -77.87497 -77.7083 -77.54163 ... -24.874966 -24.7083
  * YG        (YG) float32 -77.9583 -77.79163 -77.62497 ... -24.9583 -24.791632
  * Z         (Z) float32 -5.0 -15.5 -27.0 -39.5 ... -5075.0 -5325.0 -5575.0
  * Zl        (Zl) float32 0.0 -10.0 -21.0 -33.0 ... -4950.0 -5200.0 -5450.0
  * Zp1       (Zp1) float32 0.0 -10.0 -21.0 -33.0 ... -5200.0 -5450.0 -5700.0
  * Zu        (Zu) float32 -10.0 -21.0 -33.0 -46.0 ... -5200.0 -5450.0 -5700.0
    drC       (Zp1) float32 dask.array&lt;shape=(43,), chunksize=(43,)&gt;
    drF       (Z) float32 dask.array&lt;shape=(42,), chunksize=(42,)&gt;
    dxC       (YC, XG) float32 dask.array&lt;shape=(320, 2160), chunksize=(320, 2160)&gt;
    dxG       (YG, XC) float32 dask.array&lt;shape=(320, 2160), chunksize=(320, 2160)&gt;
    dyC       (YG, XC) float32 dask.array&lt;shape=(320, 2160), chunksize=(320, 2160)&gt;
    dyG       (YC, XG) float32 dask.array&lt;shape=(320, 2160), chunksize=(320, 2160)&gt;
    hFacC     (Z, YC, XC) float32 dask.array&lt;shape=(42, 320, 2160), chunksize=(42, 320, 2160)&gt;
    hFacS     (Z, YG, XC) float32 dask.array&lt;shape=(42, 320, 2160), chunksize=(42, 320, 2160)&gt;
    hFacW     (Z, YC, XG) float32 dask.array&lt;shape=(42, 320, 2160), chunksize=(42, 320, 2160)&gt;
    iter      (time) int64 dask.array&lt;shape=(438,), chunksize=(438,)&gt;
    rA        (YC, XC) float32 dask.array&lt;shape=(320, 2160), chunksize=(320, 2160)&gt;
    rAs       (YG, XC) float32 dask.array&lt;shape=(320, 2160), chunksize=(320, 2160)&gt;
    rAw       (YC, XG) float32 dask.array&lt;shape=(320, 2160), chunksize=(320, 2160)&gt;
    rAz       (YG, XG) float32 dask.array&lt;shape=(320, 2160), chunksize=(320, 2160)&gt;
  * time      (time) datetime64[ns] 2005-01-06 2005-01-11 ... 2010-12-31
Data variables:
    ADVr_SLT  (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    ADVr_TH   (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    ADVx_SLT  (time, Z, YC, XG) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    ADVx_TH   (time, Z, YC, XG) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    ADVy_SLT  (time, Z, YG, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    ADVy_TH   (time, Z, YG, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    DFrE_SLT  (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    DFrE_TH   (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    DFrI_SLT  (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    DFrI_TH   (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    DFxE_SLT  (time, Z, YC, XG) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    DFxE_TH   (time, Z, YC, XG) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    DFyE_SLT  (time, Z, YG, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    DFyE_TH   (time, Z, YG, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    DRHODR    (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    ETAN      (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    EXFswnet  (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    KPPg_SLT  (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    KPPg_TH   (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    PHIHYD    (time, Z, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    SALT      (time, Z, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    SFLUX     (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIarea    (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIatmFW   (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIatmQnt  (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIdHbATC  (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIdHbATO  (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIdHbOCN  (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIdSbATC  (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIdSbOCN  (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIempmr   (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIfu      (time, YC, XG) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIfv      (time, YG, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIheff    (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIhsnow   (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIsnPrcp  (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SItflux   (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIuheff   (time, YC, XG) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIuice    (time, YC, XG) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIvheff   (time, YG, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    SIvice    (time, YG, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    TFLUX     (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    THETA     (time, Z, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    TOTSTEND  (time, Z, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    TOTTTEND  (time, Z, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    UVEL      (time, Z, YC, XG) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    VVEL      (time, Z, YG, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    WSLTMASS  (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    WTHMASS   (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    WVEL      (time, Zl, YC, XC) float32 dask.array&lt;shape=(438, 42, 320, 2160), chunksize=(1, 42, 320, 2160)&gt;
    oceFreez  (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    oceQsw    (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    oceTAUX   (time, YC, XG) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    oceTAUY   (time, YG, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    surForcS  (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
    surForcT  (time, YC, XC) float32 dask.array&lt;shape=(438, 320, 2160), chunksize=(1, 320, 2160)&gt;
</pre></div>
</div>
</div>
</div>
<p>This dataset has a lot of output variables. For this lecture we are going to focus on sea surface temperature. In the model this is represented by the surfac layer in the vertical (dimension <code class="docutils literal notranslate"><span class="pre">Z</span></code>) of the temperature dataarray <code class="docutils literal notranslate"><span class="pre">THETA</span></code>.</p>
<p>Lets create a new <code class="docutils literal notranslate"><span class="pre">sst_model</span></code> dataarray and plot the first time step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sst_model</span> <span class="o">=</span> <span class="n">ds_model</span><span class="o">.</span><span class="n">THETA</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sst_model</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f466c068710&gt;
</pre></div>
</div>
<img alt="../../_images/regridding_5_1.png" src="../../_images/regridding_5_1.png" />
</div>
</div>
<p>As the name suggests, this model output is not global, but instead focusses on the Southern Ocean.
A common analysis step is model validation - comparing model output to an observation of the same variable. We will use the previously used sea surface temperature dataset.</p>
<p>We load the dataset as before, but limit the latitude dimension to exclude values in the tropics and the northern hemisphere.</p>
<blockquote>
<div><p>Note that the <code class="docutils literal notranslate"><span class="pre">lon</span></code> dimension in the dataset is given in descending order, e.g. the first value is the northernmost. You can change the order by applying <code class="docutils literal notranslate"><span class="pre">sortby('lat')</span></code>, which will reshuffle the full dataset so that <code class="docutils literal notranslate"><span class="pre">lat</span></code> values are monotonically increasing.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># xr.set_options(display_style=&#39;html&#39;) # !!! need to update xarray for this?</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://www.esrl.noaa.gov/psd/thredds/dodsC/Datasets/noaa.ersst.v5/sst.mnmean.nc&#39;</span>
<span class="n">ds_obs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>
<span class="c1"># restrict the obs to the southern ocean</span>
<span class="n">ds_obs</span> <span class="o">=</span> <span class="n">ds_obs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">))</span>
<span class="n">ds_obs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:    (lat: 32, lon: 180, nbnds: 2, time: 1990)
Coordinates:
  * lat        (lat) float64 -88.0 -86.0 -84.0 -82.0 ... -32.0 -30.0 -28.0 -26.0
  * lon        (lon) float64 0.0 2.0 4.0 6.0 8.0 ... 352.0 354.0 356.0 358.0
  * time       (time) datetime64[ns] 1854-01-01 1854-02-01 ... 2019-10-01
Dimensions without coordinates: nbnds
Data variables:
    time_bnds  (time, nbnds) float64 dask.array&lt;shape=(1990, 2), chunksize=(12, 2)&gt;
    sst        (time, lat, lon) float32 dask.array&lt;shape=(1990, 32, 180), chunksize=(12, 32, 180)&gt;
Attributes:
    climatology:                     Climatology is based on 1971-2000 SST, X...
    description:                     In situ data: ICOADS2.5 before 2007 and ...
    keywords_vocabulary:             NASA Global Change Master Directory (GCM...
    keywords:                        Earth Science &gt; Oceans &gt; Ocean Temperatu...
    instrument:                      Conventional thermometers
    source_comment:                  SSTs were observed by conventional therm...
    geospatial_lon_min:              -1.0
    geospatial_lon_max:              359.0
    geospatial_laty_max:             89.0
    geospatial_laty_min:             -89.0
    geospatial_lat_max:              89.0
    geospatial_lat_min:              -89.0
    geospatial_lat_units:            degrees_north
    geospatial_lon_units:            degrees_east
    cdm_data_type:                   Grid
    project:                         NOAA Extended Reconstructed Sea Surface ...
    original_publisher_url:          http://www.ncdc.noaa.gov
    References:                      https://www.ncdc.noaa.gov/data-access/ma...
    source:                          In situ data: ICOADS R3.0 before 2015, N...
    title:                           NOAA ERSSTv5 (in situ only)
    history:                         created 07/2017 by PSD data using NCEI&#39;s...
    institution:                     This version written at NOAA/ESRL PSD: o...
    citation:                        Huang et al, 2017: Extended Reconstructe...
    platform:                        Ship and Buoy SSTs from ICOADS R3.0 and ...
    standard_name_vocabulary:        CF Standard Name Table (v40, 25 January ...
    processing_level:                NOAA Level 4
    Conventions:                     CF-1.6, ACDD-1.3
    metadata_link:                   :metadata_link = https://doi.org/10.7289...
    creator_name:                    Boyin Huang (original)
    date_created:                    2017-06-30T12:18:00Z (original)
    product_version:                 Version 5
    creator_url_original:            https://www.ncei.noaa.gov
    license:                         No constraints on data access or use
    comment:                         SSTs were observed by conventional therm...
    summary:                         ERSST.v5 is developed based on v4 after ...
    dataset_title:                   NOAA Extended Reconstructed SST V5
    data_modified:                   2019-11-04
    DODS_EXTRA.Unlimited_Dimension:  time
</pre></div>
</div>
</div>
</div>
<p>Lets now define a new dataarray so that we have a consistent naming between the model output and observations. As before we also plot the first time step of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sst_obs</span> <span class="o">=</span> <span class="n">ds_obs</span><span class="o">.</span><span class="n">sst</span>
<span class="n">sst_obs</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f465431c8d0&gt;
</pre></div>
</div>
<img alt="../../_images/regridding_9_1.png" src="../../_images/regridding_9_1.png" />
</div>
</div>
<section id="considerations-for-model-validation">
<h2>Considerations for model validation<a class="headerlink" href="#considerations-for-model-validation" title="Permalink to this headline">#</a></h2>
<p>Now that we have both datasets loaded, how do we approach the model validation?</p>
<p>It is always crucial to put some thought into which time periods of a model and observations are actually comparable. In this case both should be directly comparable since SOSE is a state estimate, which incorporates observations to estimate the state of the ocean at the time observations were taken (and in between). If however the model data would be from a fully coupled climate model, we would have to take e.g. long averages due to the fact that internal variability - like for instance ENSO - can not be expected to happen in the same year as observations. But since we chose a state estimate, we can actually compare the data in a single year or even month (this will save us some computing time, but if you are interested, go ahead and choose a longer averaging period below and compare the results).</p>
<p>Now select a time period that overlaps between model and observations, e.g. the year 2009 and average over the year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sst_model</span> <span class="o">=</span> <span class="n">sst_model</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;2009&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">sst_obs</span> <span class="o">=</span> <span class="n">sst_obs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;2009&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/srv/conda/envs/notebook/lib/python3.7/site-packages/dask/array/numpy_compat.py:38: RuntimeWarning: invalid value encountered in true_divide
  x = np.divide(x1, x2, out)
</pre></div>
</div>
</div>
</div>
<p>For later we will also rename the model dimensions <code class="docutils literal notranslate"><span class="pre">XC</span></code> and <code class="docutils literal notranslate"><span class="pre">YC</span></code> into <code class="docutils literal notranslate"><span class="pre">lon</span></code> and <code class="docutils literal notranslate"><span class="pre">lat</span></code>, so that both model and observations are named consistently.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sst_model</span> <span class="o">=</span> <span class="n">sst_model</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="s1">&#39;lat&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>We can now plot both fields next to each other. By specifying <code class="docutils literal notranslate"><span class="pre">vmax=30</span></code> in the plot command, we ensure that both plots have the exact same colorbar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># !!! is this taught before?</span>
<span class="n">sst_obs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="c1"># make sure to have the same colorlimit</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">24</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sst_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f4654183c50&gt;
</pre></div>
</div>
<img alt="../../_images/regridding_15_1.png" src="../../_images/regridding_15_1.png" />
</div>
</div>
<p>This looks nice and the large scale structure (colder waters near Antarctica) agree. But since temperature differs over such a wide range, it is hard to quantify the differences with the naked eye. Naturally we would want to plot the difference between both datasets.</p>
</section>
<section id="regridding-via-interpolation">
<h2>Regridding via interpolation<a class="headerlink" href="#regridding-via-interpolation" title="Permalink to this headline">#</a></h2>
<p>There is however a major problem: Both datasets are on a different grid - the model has a much higher resolution (~ 1/5 deg) than the observations (~ 2 degree). In the model we can see signs of mesoscale eddies, even in the yearly average.</p>
<p>To compare the dataset directly they have to be on the same grid, e.g. each point of the array has to correspond to the same position.</p>
<p><em>We have 3 options to achieve this</em>:</p>
<ol class="simple">
<li><p>Regrid the lower resolution dataset (observations) onto the higher resolution dataset (model).</p></li>
<li><p>Regrid the higher resolution dataset (model) onto the lower resolution dataset (observations).</p></li>
<li><p>Define a completely new grid and regrid both datasets onto that.</p></li>
</ol>
<p>Both 1. and 2. have unique advantages and disadvantages, whereas 3. can share some or all of these, depending on whether the new grid is defined on a higher, lower or intermediate resolution compared to the two datasets.</p>
<p>Lets try both approaches and see how they compare. For this step we will use <a class="reference external" href="https://xesmf.readthedocs.io/en/latest/">xesmf</a> a very powerful geospatial regridding tool.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xesmf</span> <span class="k">as</span> <span class="nn">xe</span>
</pre></div>
</div>
</div>
</div>
<p>To regrid a dataarray with xesmf you need to execute the following steps:</p>
<ol>
<li><p>Create a target grid dataset (this can also be an existing dataset)</p>
<blockquote>
<div><p>Note: Rename the dataset appropriately. xesmf expects longitude and latitude to be labelled as <code class="docutils literal notranslate"><span class="pre">lon</span></code> and <code class="docutils literal notranslate"><span class="pre">lat</span></code> (this is the reason we renamed the model dataset previously).</p>
</div></blockquote>
</li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">regridder</span></code> object (using the target grid and the source dataset - e.g. the dataset that should be regridded)</p>
<blockquote>
<div><p>Note: You might have to clean existing files that the regridder might have written out using <code class="docutils literal notranslate"><span class="pre">regridder.clean_weight_file()</span></code> (this is only needed if the regridder has been previously applied, but it does not hurt to apply it just in case)</p>
</div></blockquote>
</li>
<li><p>Apply the <code class="docutils literal notranslate"><span class="pre">regridder</span></code> to a dataset, e.g. <code class="docutils literal notranslate"><span class="pre">regridder(ds)</span></code></p></li>
</ol>
<p>We will start by regridding the low resolution observations onto the high resolution model grid, by using linear interpolation in two dimensions (<code class="docutils literal notranslate"><span class="pre">bilinear</span></code>) and specifying that our domain is periodic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regridder</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">sst_obs</span><span class="p">,</span> <span class="n">sst_model</span><span class="p">,</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#since this is global we need to pass periodic</span>
<span class="n">regridder</span><span class="o">.</span><span class="n">clean_weight_file</span><span class="p">()</span>
<span class="n">regridder</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Create weight file: bilinear_32x180_320x2160_peri.nc
Remove file bilinear_32x180_320x2160_peri.nc
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>xESMF Regridder 
Regridding algorithm:       bilinear 
Weight filename:            bilinear_32x180_320x2160_peri.nc 
Reuse pre-computed weights? False 
Input grid shape:           (32, 180) 
Output grid shape:          (320, 2160) 
Output grid dimension name: (&#39;lat&#39;, &#39;lon&#39;) 
Periodic in longitude?      True
</pre></div>
</div>
</div>
</div>
<p>We can now apply the regridder to the observed sea surface temperature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sst_obs_regridded</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">(</span><span class="n">sst_obs</span><span class="p">)</span>
<span class="n">sst_obs_regridded</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.DataArray &#39;sst&#39; (lat: 320, lon: 2160)&gt;
array([[nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       ...,
       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
       [ 0.,  0.,  0., ...,  0.,  0.,  0.]])
Coordinates:
  * lon      (lon) float32 0.083333336 0.25 0.4166667 ... 359.75 359.9167
  * lat      (lat) float32 -77.87497 -77.7083 -77.54163 ... -24.874966 -24.7083
Attributes:
    regrid_method:  bilinear
</pre></div>
</div>
</div>
</div>
<p>You see that the size of the dimensions has increased. It is now the same as the model data. Lets see how the regridded data compares.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sst_obs_regridded</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="c1"># make sure to have the same colorlimit</span>
<span class="c1"># plt.ylim(-80, -24)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sst_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f4648031320&gt;
</pre></div>
</div>
<img alt="../../_images/regridding_23_1.png" src="../../_images/regridding_23_1.png" />
</div>
</div>
<p>The observations now have more datapoints and look a lot smoother, but since the values are just linearly interpolated, there is no new information on smaller scales.</p>
<p>Now lets compare both estimates by computing the difference.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff</span> <span class="o">=</span> <span class="n">sst_model</span> <span class="o">-</span> <span class="n">sst_obs_regridded</span> 
<span class="n">diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f4643f08320&gt;
</pre></div>
</div>
<img alt="../../_images/regridding_25_1.png" src="../../_images/regridding_25_1.png" />
</div>
</div>
<p>We can see that the model sea surface temperature is quite a bit different (up to 2 deg C in some places). But the comparison is hindered by a lot of smaller scale structure that stems from eddies in the model data, which are not resolved in the observations.</p>
<p>This is the major disadvantage of Method 1. from above: The comparison becomes ‚Äòunfair‚Äô because we are usually only interested on larger scale differences. Even if the observations would have a higher resolution, from our physical understanding we would not expect that turbulent features like ocean eddies would happen at the exact same space and time in the model as the observations.</p>
<p>So how do we solve this issue? Lets look at method 2. to compare the model and observations on a lower resolution.
We first try the exact same procedure as befor (linear interpolation), but switch the source and target datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regridder</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">sst_model</span><span class="p">,</span><span class="n">sst_obs</span><span class="p">,</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#since this is global we need to pass periodic</span>
<span class="n">regridder</span><span class="o">.</span><span class="n">clean_weight_file</span><span class="p">()</span>
<span class="n">sst_model_regridded</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">(</span><span class="n">sst_model</span><span class="p">)</span>
<span class="n">sst_model_regridded</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Create weight file: bilinear_320x2160_32x180_peri.nc
Remove file bilinear_320x2160_32x180_peri.nc
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.DataArray &#39;THETA&#39; (lat: 32, lon: 180)&gt;
array([[ 0.      ,  0.      ,  0.      , ...,  0.      ,  0.      ,  0.      ],
       [ 0.      ,  0.      ,  0.      , ...,  0.      ,  0.      ,  0.      ],
       [ 0.      ,  0.      ,  0.      , ...,  0.      ,  0.      ,  0.      ],
       ...,
       [20.185935, 19.964374, 19.690668, ..., 20.646542, 20.335984, 20.317114],
       [20.801154, 20.477957, 20.144566, ..., 21.67011 , 21.22205 , 21.067159],
       [20.903206, 20.605169, 20.364102, ..., 21.828444, 21.537927, 21.231561]])
Coordinates:
    PHrefC   float32 49.05
    Z        float32 -5.0
    drF      float32 10.0
  * lon      (lon) float64 0.0 2.0 4.0 6.0 8.0 ... 350.0 352.0 354.0 356.0 358.0
  * lat      (lat) float64 -88.0 -86.0 -84.0 -82.0 ... -32.0 -30.0 -28.0 -26.0
Attributes:
    regrid_method:  bilinear
</pre></div>
</div>
</div>
</div>
<p>Lets compare the original observations against the regridded model data as before</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff</span> <span class="o">=</span> <span class="n">sst_model_regridded</span> <span class="o">-</span> <span class="n">sst_obs</span>
<span class="n">diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f4643ebf4a8&gt;
</pre></div>
</div>
<img alt="../../_images/regridding_29_1.png" src="../../_images/regridding_29_1.png" />
</div>
</div>
<p>That was easy enough, but there is a problem with this approach. Using linear interpolation works very well when we ‚Äòupsample‚Äô (going from lower to higher resolution), since most of the interpolated points are between the wider spaced original data. If we ‚Äòdownsample‚Äô (going from higher resolution to lower resolution), this method will only use the two nearest points to infer a new value. This means most of the high resolution source data is not taken into consideration, and small noisy features can have a disproportionate influence on the regridded data. It also implies that properties like tracer concentrations over the full domain are not necessarily conserved.</p>
<p>We can plot the original and the downsampled modeldata along a constant latitude to illustrate the problem</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_lat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">46</span>
<span class="n">sst_model</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">sample_lat</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
<span class="n">sst_model_regridded</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="n">sample_lat</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f4638207898&gt;]
</pre></div>
</div>
<img alt="../../_images/regridding_31_1.png" src="../../_images/regridding_31_1.png" />
</div>
</div>
<p>As you can see the upsampled datapoints depend highly on the position of the target grid. What we should rather do in this case is average values around the wider target grid. This can be achieved by using a different method in xesmf.</p>
</section>
<section id="regridding-using-conservative-interpolation">
<h2>Regridding using conservative interpolation<a class="headerlink" href="#regridding-using-conservative-interpolation" title="Permalink to this headline">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">conservative</span></code> option will take an average over several grid cells to reduce the resolution of the model. This ensures that no information is discarded and that for instance adjacent positive and negative anomalies are not increasing the noise in the regridded data.</p>
<p>This method is always preferable, when moving to lower resolutions, especially when the data is not very smooth. Unfortunately this also requires some more input parameter, namely the bounding coordinates of each gridpoint (in addition to the center or tracer coordinate; see schematic in the introduction). xesmf expects those coordinates to be named <code class="docutils literal notranslate"><span class="pre">lon_b</span></code> and <code class="docutils literal notranslate"><span class="pre">lat_b</span></code>.</p>
<p>When we look carefully at the model data, these bounding coordinates are already given (as the coodinates for the <span class="math notranslate nohighlight">\(u\)</span> and <span class="math notranslate nohighlight">\(v\)</span> velocities on a staggered grid - <code class="docutils literal notranslate"><span class="pre">XC</span></code> and <code class="docutils literal notranslate"><span class="pre">YC</span></code> respectively), but xesmf requires a bounding value at each side (This model does only provides the same amount of coordinate values for both tracer and velocity points).</p>
<p>We have two options: a) Remove one of the tracer points and leave the velocity points as is, or b) add an additional coordinate value.</p>
<p>Since the model has a significantly higher resolution, we will chose the simpler way a) and just remove one tracer point, omitting one out of 10 points for the new coarse grid (which is acceptable in this case).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modified_grid_model</span> <span class="o">=</span> <span class="n">ds_model</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">XC</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                    <span class="n">YC</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;XC&#39;</span><span class="p">:</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;XG&#39;</span><span class="p">:</span><span class="s1">&#39;lon_b&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;YC&#39;</span><span class="p">:</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;YG&#39;</span><span class="p">:</span><span class="s1">&#39;lat_b&#39;</span><span class="p">})</span>

<span class="n">modified_grid_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:   (Z: 42, Zl: 42, Zp1: 43, Zu: 42, lat: 319, lat_b: 320, lon: 2159, lon_b: 2160, time: 438)
Coordinates:
    Depth     (lat, lon) float32 dask.array&lt;shape=(319, 2159), chunksize=(319, 2159)&gt;
    PHrefC    (Z) float32 dask.array&lt;shape=(42,), chunksize=(42,)&gt;
    PHrefF    (Zp1) float32 dask.array&lt;shape=(43,), chunksize=(43,)&gt;
  * lon       (lon) float32 0.083333336 0.25 0.4166667 ... 359.58334 359.75
  * lon_b     (lon_b) float32 5.551115e-17 0.16666667 ... 359.6667 359.83334
  * lat       (lat) float32 -77.87497 -77.7083 ... -25.041632 -24.874966
  * lat_b     (lat_b) float32 -77.9583 -77.79163 ... -24.9583 -24.791632
  * Z         (Z) float32 -5.0 -15.5 -27.0 -39.5 ... -5075.0 -5325.0 -5575.0
  * Zl        (Zl) float32 0.0 -10.0 -21.0 -33.0 ... -4950.0 -5200.0 -5450.0
  * Zp1       (Zp1) float32 0.0 -10.0 -21.0 -33.0 ... -5200.0 -5450.0 -5700.0
  * Zu        (Zu) float32 -10.0 -21.0 -33.0 -46.0 ... -5200.0 -5450.0 -5700.0
    drC       (Zp1) float32 dask.array&lt;shape=(43,), chunksize=(43,)&gt;
    drF       (Z) float32 dask.array&lt;shape=(42,), chunksize=(42,)&gt;
    dxC       (lat, lon_b) float32 dask.array&lt;shape=(319, 2160), chunksize=(319, 2160)&gt;
    dxG       (lat_b, lon) float32 dask.array&lt;shape=(320, 2159), chunksize=(320, 2159)&gt;
    dyC       (lat_b, lon) float32 dask.array&lt;shape=(320, 2159), chunksize=(320, 2159)&gt;
    dyG       (lat, lon_b) float32 dask.array&lt;shape=(319, 2160), chunksize=(319, 2160)&gt;
    hFacC     (Z, lat, lon) float32 dask.array&lt;shape=(42, 319, 2159), chunksize=(42, 319, 2159)&gt;
    hFacS     (Z, lat_b, lon) float32 dask.array&lt;shape=(42, 320, 2159), chunksize=(42, 320, 2159)&gt;
    hFacW     (Z, lat, lon_b) float32 dask.array&lt;shape=(42, 319, 2160), chunksize=(42, 319, 2160)&gt;
    iter      (time) int64 dask.array&lt;shape=(438,), chunksize=(438,)&gt;
    rA        (lat, lon) float32 dask.array&lt;shape=(319, 2159), chunksize=(319, 2159)&gt;
    rAs       (lat_b, lon) float32 dask.array&lt;shape=(320, 2159), chunksize=(320, 2159)&gt;
    rAw       (lat, lon_b) float32 dask.array&lt;shape=(319, 2160), chunksize=(319, 2160)&gt;
    rAz       (lat_b, lon_b) float32 dask.array&lt;shape=(320, 2160), chunksize=(320, 2160)&gt;
  * time      (time) datetime64[ns] 2005-01-06 2005-01-11 ... 2010-12-31
Data variables:
    ADVr_SLT  (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    ADVr_TH   (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    ADVx_SLT  (time, Z, lat, lon_b) float32 dask.array&lt;shape=(438, 42, 319, 2160), chunksize=(1, 42, 319, 2160)&gt;
    ADVx_TH   (time, Z, lat, lon_b) float32 dask.array&lt;shape=(438, 42, 319, 2160), chunksize=(1, 42, 319, 2160)&gt;
    ADVy_SLT  (time, Z, lat_b, lon) float32 dask.array&lt;shape=(438, 42, 320, 2159), chunksize=(1, 42, 320, 2159)&gt;
    ADVy_TH   (time, Z, lat_b, lon) float32 dask.array&lt;shape=(438, 42, 320, 2159), chunksize=(1, 42, 320, 2159)&gt;
    DFrE_SLT  (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    DFrE_TH   (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    DFrI_SLT  (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    DFrI_TH   (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    DFxE_SLT  (time, Z, lat, lon_b) float32 dask.array&lt;shape=(438, 42, 319, 2160), chunksize=(1, 42, 319, 2160)&gt;
    DFxE_TH   (time, Z, lat, lon_b) float32 dask.array&lt;shape=(438, 42, 319, 2160), chunksize=(1, 42, 319, 2160)&gt;
    DFyE_SLT  (time, Z, lat_b, lon) float32 dask.array&lt;shape=(438, 42, 320, 2159), chunksize=(1, 42, 320, 2159)&gt;
    DFyE_TH   (time, Z, lat_b, lon) float32 dask.array&lt;shape=(438, 42, 320, 2159), chunksize=(1, 42, 320, 2159)&gt;
    DRHODR    (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    ETAN      (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    EXFswnet  (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    KPPg_SLT  (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    KPPg_TH   (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    PHIHYD    (time, Z, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    SALT      (time, Z, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    SFLUX     (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIarea    (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIatmFW   (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIatmQnt  (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIdHbATC  (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIdHbATO  (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIdHbOCN  (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIdSbATC  (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIdSbOCN  (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIempmr   (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIfu      (time, lat, lon_b) float32 dask.array&lt;shape=(438, 319, 2160), chunksize=(1, 319, 2160)&gt;
    SIfv      (time, lat_b, lon) float32 dask.array&lt;shape=(438, 320, 2159), chunksize=(1, 320, 2159)&gt;
    SIheff    (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIhsnow   (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIsnPrcp  (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SItflux   (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    SIuheff   (time, lat, lon_b) float32 dask.array&lt;shape=(438, 319, 2160), chunksize=(1, 319, 2160)&gt;
    SIuice    (time, lat, lon_b) float32 dask.array&lt;shape=(438, 319, 2160), chunksize=(1, 319, 2160)&gt;
    SIvheff   (time, lat_b, lon) float32 dask.array&lt;shape=(438, 320, 2159), chunksize=(1, 320, 2159)&gt;
    SIvice    (time, lat_b, lon) float32 dask.array&lt;shape=(438, 320, 2159), chunksize=(1, 320, 2159)&gt;
    TFLUX     (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    THETA     (time, Z, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    TOTSTEND  (time, Z, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    TOTTTEND  (time, Z, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    UVEL      (time, Z, lat, lon_b) float32 dask.array&lt;shape=(438, 42, 319, 2160), chunksize=(1, 42, 319, 2160)&gt;
    VVEL      (time, Z, lat_b, lon) float32 dask.array&lt;shape=(438, 42, 320, 2159), chunksize=(1, 42, 320, 2159)&gt;
    WSLTMASS  (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    WTHMASS   (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    WVEL      (time, Zl, lat, lon) float32 dask.array&lt;shape=(438, 42, 319, 2159), chunksize=(1, 42, 319, 2159)&gt;
    oceFreez  (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    oceQsw    (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    oceTAUX   (time, lat, lon_b) float32 dask.array&lt;shape=(438, 319, 2160), chunksize=(1, 319, 2160)&gt;
    oceTAUY   (time, lat_b, lon) float32 dask.array&lt;shape=(438, 320, 2159), chunksize=(1, 320, 2159)&gt;
    surForcS  (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
    surForcT  (time, lat, lon) float32 dask.array&lt;shape=(438, 319, 2159), chunksize=(1, 319, 2159)&gt;
</pre></div>
</div>
</div>
</div>
<p>For the observations we choose method b.</p>
<p>Since the data are given on a regular 2 by 2 degree grid, we construct the bounding coordinates by subtracting 1 deg of the center point and adding another point at the end.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lon_boundary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">ds_obs</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">ds_obs</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">lat_boundary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">ds_obs</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">ds_obs</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">modified_grid_obs</span> <span class="o">=</span> <span class="n">ds_obs</span>
<span class="n">modified_grid_obs</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lon_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">lon_boundary</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lon_b&#39;</span><span class="p">])</span>
<span class="n">modified_grid_obs</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;lat_b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">lat_boundary</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat_b&#39;</span><span class="p">])</span>
<span class="n">modified_grid_obs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:    (lat: 32, lat_b: 33, lon: 180, lon_b: 181, nbnds: 2, time: 1990)
Coordinates:
  * lat        (lat) float64 -88.0 -86.0 -84.0 -82.0 ... -32.0 -30.0 -28.0 -26.0
  * lon        (lon) float64 0.0 2.0 4.0 6.0 8.0 ... 352.0 354.0 356.0 358.0
  * time       (time) datetime64[ns] 1854-01-01 1854-02-01 ... 2019-10-01
  * lon_b      (lon_b) float64 -1.0 1.0 3.0 5.0 7.0 ... 353.0 355.0 357.0 359.0
  * lat_b      (lat_b) float64 -89.0 -87.0 -85.0 -83.0 ... -29.0 -27.0 -25.0
Dimensions without coordinates: nbnds
Data variables:
    time_bnds  (time, nbnds) float64 dask.array&lt;shape=(1990, 2), chunksize=(12, 2)&gt;
    sst        (time, lat, lon) float32 dask.array&lt;shape=(1990, 32, 180), chunksize=(12, 32, 180)&gt;
Attributes:
    climatology:                     Climatology is based on 1971-2000 SST, X...
    description:                     In situ data: ICOADS2.5 before 2007 and ...
    keywords_vocabulary:             NASA Global Change Master Directory (GCM...
    keywords:                        Earth Science &gt; Oceans &gt; Ocean Temperatu...
    instrument:                      Conventional thermometers
    source_comment:                  SSTs were observed by conventional therm...
    geospatial_lon_min:              -1.0
    geospatial_lon_max:              359.0
    geospatial_laty_max:             89.0
    geospatial_laty_min:             -89.0
    geospatial_lat_max:              89.0
    geospatial_lat_min:              -89.0
    geospatial_lat_units:            degrees_north
    geospatial_lon_units:            degrees_east
    cdm_data_type:                   Grid
    project:                         NOAA Extended Reconstructed Sea Surface ...
    original_publisher_url:          http://www.ncdc.noaa.gov
    References:                      https://www.ncdc.noaa.gov/data-access/ma...
    source:                          In situ data: ICOADS R3.0 before 2015, N...
    title:                           NOAA ERSSTv5 (in situ only)
    history:                         created 07/2017 by PSD data using NCEI&#39;s...
    institution:                     This version written at NOAA/ESRL PSD: o...
    citation:                        Huang et al, 2017: Extended Reconstructe...
    platform:                        Ship and Buoy SSTs from ICOADS R3.0 and ...
    standard_name_vocabulary:        CF Standard Name Table (v40, 25 January ...
    processing_level:                NOAA Level 4
    Conventions:                     CF-1.6, ACDD-1.3
    metadata_link:                   :metadata_link = https://doi.org/10.7289...
    creator_name:                    Boyin Huang (original)
    date_created:                    2017-06-30T12:18:00Z (original)
    product_version:                 Version 5
    creator_url_original:            https://www.ncei.noaa.gov
    license:                         No constraints on data access or use
    comment:                         SSTs were observed by conventional therm...
    summary:                         ERSST.v5 is developed based on v4 after ...
    dataset_title:                   NOAA Extended Reconstructed SST V5
    data_modified:                   2019-11-04
    DODS_EXTRA.Unlimited_Dimension:  time
</pre></div>
</div>
</div>
</div>
<p>Now we can create a conservative <code class="docutils literal notranslate"><span class="pre">regridder</span></code> by passing the modified grids and the method <code class="docutils literal notranslate"><span class="pre">conservative</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regridder</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">modified_grid_model</span><span class="p">,</span> <span class="n">modified_grid_obs</span><span class="p">,</span> <span class="s1">&#39;conservative&#39;</span><span class="p">)</span> <span class="c1">#since this is global we need to pass periodic</span>
<span class="n">regridder</span><span class="o">.</span><span class="n">clean_weight_file</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Create weight file: conservative_319x2159_32x180.nc
Remove file conservative_319x2159_32x180.nc
</pre></div>
</div>
</div>
</div>
<p>We then apply this new regridder to the model again. Note that we have to cut one data point of again, as done above for the full dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sst_model_regridded_cons</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">(</span><span class="n">sst_model</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">sst_model_regridded_cons</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/srv/conda/envs/notebook/lib/python3.7/site-packages/xesmf/smm.py:70: UserWarning: Input array is not C_CONTIGUOUS. Will affect performance.
  warnings.warn(&quot;Input array is not C_CONTIGUOUS. &quot;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.DataArray &#39;THETA&#39; (lat: 32, lon: 180)&gt;
array([[ 0.      ,  0.      ,  0.      , ...,  0.      ,  0.      ,  0.      ],
       [ 0.      ,  0.      ,  0.      , ...,  0.      ,  0.      ,  0.      ],
       [ 0.      ,  0.      ,  0.      , ...,  0.      ,  0.      ,  0.      ],
       ...,
       [18.509935, 19.955008, 19.740049, ..., 20.661682, 20.400264, 20.323238],
       [19.04155 , 20.459897, 20.165475, ..., 21.616568, 21.226791, 21.009231],
       [19.162298, 20.607543, 20.363888, ..., 21.796622, 21.500974, 21.201145]])
Coordinates:
    PHrefC   float32 49.05
    Z        float32 -5.0
    drF      float32 10.0
  * lon      (lon) float64 0.0 2.0 4.0 6.0 8.0 ... 350.0 352.0 354.0 356.0 358.0
  * lat      (lat) float64 -88.0 -86.0 -84.0 -82.0 ... -32.0 -30.0 -28.0 -26.0
Attributes:
    regrid_method:  conservative
</pre></div>
</div>
</div>
</div>
<p>Now we can compare the difference between the datasets using both the interpolation and conservative method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">sst_model_regridded</span> <span class="o">-</span> <span class="n">sst_obs</span>
<span class="n">diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">sst_model_regridded_cons</span> <span class="o">-</span> <span class="n">sst_obs</span>
<span class="n">diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7f464348bb38&gt;
</pre></div>
</div>
<img alt="../../_images/regridding_42_1.png" src="../../_images/regridding_42_1.png" />
</div>
</div>
<p>As expected the downsampling (regridding to lower resolution) via interpolation shows more noise. But even in the conservative regridding case there are still many alternating positive and negative anomalies, indicative of the fact that the observations so not resolve features down to the scale of the grid. This is a common issue with observational datasets, which have to use smoothing techniques to aquire a gridded dataset from point measurements.</p>
<p>So lastly we will conservatively regrid both datasets to an even coarser resolution (Method 3.) to alleviate some of this problematic.</p>
<p>To do this we define a coarse global grid using <code class="docutils literal notranslate"><span class="pre">xesmf.util.grid_global</span></code> and cut it appropriately (remember to leave the bounding coordinates <code class="docutils literal notranslate"><span class="pre">lon_b</span></code> and <code class="docutils literal notranslate"><span class="pre">lat_b</span></code> one element longer).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coarse_grid</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">grid_global</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="n">y_b</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">17</span><span class="p">))</span>
<span class="n">coarse_grid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:  (x: 72, x_b: 73, y: 16, y_b: 17)
Coordinates:
    lon      (y, x) float64 -177.5 -172.5 -167.5 -162.5 ... 167.5 172.5 177.5
    lat      (y, x) float64 -87.5 -87.5 -87.5 -87.5 ... -12.5 -12.5 -12.5 -12.5
    lon_b    (y_b, x_b) int64 -180 -175 -170 -165 -160 ... 160 165 170 175 180
    lat_b    (y_b, x_b) int64 -90 -90 -90 -90 -90 -90 ... -10 -10 -10 -10 -10
Dimensions without coordinates: x, x_b, y, y_b
Data variables:
    *empty*
</pre></div>
</div>
</div>
</div>
<p>Now we define two new regridders and create dataarrays like before.
First with the modified model grid and the new coarse grid:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regridder</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">modified_grid_model</span><span class="p">,</span> <span class="n">coarse_grid</span><span class="p">,</span> <span class="s1">&#39;conservative&#39;</span><span class="p">)</span> <span class="c1">#since this is global we need to pass periodic</span>
<span class="n">regridder</span><span class="o">.</span><span class="n">clean_weight_file</span><span class="p">()</span>
<span class="n">sst_coarse_model</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">(</span><span class="n">sst_model</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Create weight file: conservative_319x2159_16x72.nc
Remove file conservative_319x2159_16x72.nc
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/srv/conda/envs/notebook/lib/python3.7/site-packages/xesmf/smm.py:70: UserWarning: Input array is not C_CONTIGUOUS. Will affect performance.
  warnings.warn(&quot;Input array is not C_CONTIGUOUS. &quot;
</pre></div>
</div>
</div>
</div>
<p>Then with the modified model grid and the new coarse grid:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regridder</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">modified_grid_obs</span><span class="p">,</span> <span class="n">coarse_grid</span><span class="p">,</span> <span class="s1">&#39;conservative&#39;</span><span class="p">)</span> <span class="c1">#since this is global we need to pass periodic</span>
<span class="n">regridder</span><span class="o">.</span><span class="n">clean_weight_file</span><span class="p">()</span>
<span class="n">sst_coarse_obs</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">(</span><span class="n">sst_obs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Create weight file: conservative_32x180_16x72.nc
Remove file conservative_32x180_16x72.nc
</pre></div>
</div>
</div>
</div>
<p>As a final step we visualize all four comparisons next to each other usign a Stereographic projection of the South Pole:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">()},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>

<span class="k">for</span> <span class="n">ds</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">sst_model</span> <span class="o">-</span> <span class="n">sst_obs_regridded</span><span class="p">,</span> <span class="n">sst_model_regridded</span> <span class="o">-</span> <span class="n">sst_obs</span><span class="p">,</span> <span class="n">sst_model_regridded_cons</span> <span class="o">-</span> <span class="n">sst_obs</span><span class="p">,</span> <span class="n">sst_coarse_model</span> <span class="o">-</span> <span class="n">sst_coarse_obs</span><span class="p">],</span>
                  <span class="n">axarr</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/regridding_51_0.png" src="../../_images/regridding_51_0.png" />
</div>
</div>
<p>Ultimately which method you use will depend on the particular use case. Before regridding, carefully inspect your datasets and think of what you want to achieve:</p>
<ul class="simple">
<li><p>Are both datasets of a similar resolution and relatively smooth? Then using linear interpolation should be acceptable and is by far the easiest way to compare the datasets.</p></li>
<li><p>Is the goal of the comparison to evaluate differences on larger scales than the grid scale? Then create a coarser grid and interpolate conservatively to gain a larger scale perspective without getting distracted by smaller scale features.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./lectures/models"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../../assignments/cmip.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Assignment: Calculate wet bulb temperature for CMIP6 models</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="xgcm.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Calculating properties in the native model grid using xgcm</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Ryan Abernathey<br/>
  
      &copy; Copyright 2016-2021.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>